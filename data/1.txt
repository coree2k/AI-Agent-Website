### n8n을 활용하여 자연어로 Google Calendar를 관리할 수 있는 AI 에이전트 시스템 구축 가이드입니다. <br> 복잡한 명령어 없이 "내일 오후 3시에 팀 회의 일정 잡아줘"처럼 자연스럽게 대화하면서 캘린더를 관리할 수 있습니다.

## 목차

- [시스템 개요](#시스템-개요)
- [사전 준비사항](#사전-준비사항)
- [Google Calendar API 설정](#google-calendar-api-설정)
- [n8n 워크플로우 구축](#n8n-워크플로우-구축)
- [고급 활용 팁](#고급-활용-팁)
- [문제 해결](#문제-해결)

## 시스템 개요

이 가이드에서는 자연어로 대화하면서 Google Calendar의 일정을 생성, 조회, 수정, 삭제할 수 있는 AI 에이전트를 구축합니다.

### 워크플로우 구조

> &nbsp;&nbsp;&nbsp; **Chat UI** → **Google Calendar Agent** → **AI 모델** + **메모리** + **Google Calendar 도구들(생성/조회/수정/삭제)**

![워크플로우 구조](./n8n_Source/01/02.%20WF.png)


1. **Chat UI 영역**:
   - When chat message received (채팅 트리거)

2. **Google Calendar AI Agent 영역**:
   - OpenAI Chat Model (GPT-5)
   - Simple Memory (대화 기억)
   - Google Calendar Agent (AI 에이전트 코어)
   - Google Calendar 도구 5개 (생성/조회/수정/삭제)

### 주요 기능

- 자연어로 일정 생성, 조회, 수정, 삭제
- 대화 맥락을 기억하는 10턴 메모리
- 상대적 시간 표현 자동 변환 (내일, 다음 주 등)
- 한국 시간대(Asia/Seoul) 자동 설정
- 모호한 요청에 대한 자동 확인

## 사전 준비사항

- n8n 설치 및 실행 (Cloud 또는 Self-hosted)
- Google 계정
- OpenAI API 키 (GPT-5 모델 사용)
- Google Cloud Console 접근 권한

## Google Calendar API 설정

### 1. Google Cloud Console 설정

1. [Google Cloud Console](https://console.cloud.google.com/)에 접속합니다.

2. **프로젝트 생성**:
   - 새 프로젝트 만들기
   - 프로젝트 이름 입력 (예: n8n-calendar-agent)

3. **Google Calendar API 활성화**:
   - API 및 서비스 > 라이브러리
   - "Google Calendar API" 검색
   - 활성화 클릭

### 2. OAuth 2.0 인증 정보 생성

1. **OAuth 동의 화면 구성**:
   - API 및 서비스 > OAuth 동의 화면
   - 외부 사용자 선택
   - 앱 정보 입력 (앱 이름, 사용자 지원 이메일)
   - 범위 추가: Google Calendar API 권한

2. **OAuth 2.0 클라이언트 ID 생성**:
   - 사용자 인증 정보 > 사용자 인증 정보 만들기
   - OAuth 클라이언트 ID 선택
   - 애플리케이션 유형: 웹 애플리케이션
   - 승인된 리디렉션 URI: n8n의 OAuth 콜백 URL 입력

3. **클라이언트 ID 및 보안 비밀 저장**:
   - 생성된 클라이언트 ID와 클라이언트 보안 비밀을 복사하여 저장

## n8n 워크플로우 구축

### 1. 채팅 트리거 설정

**When chat message received 노드 추가**

- **Type**: Chat Trigger
- **Mode**: Public (공개 채팅)
- **Initial Messages**: 
```
안녕하세요. 나는 Google Calendar 에이전트입니다.
Google Calendar에서 하고 싶은 작업이 있으시면 말씀해 주시면 제가 수행하도록 하겠습니다.
```
- **Webhook ID**: 자동 생성됨

### 2. Google Calendar Agent 노드 설정

**Agent 노드 추가**

**기본 설정**:
- Type: AI Agent
- Model: OpenAI Chat Model 연결
- Memory: Simple Memory 연결
- Tools: Google Calendar 도구 5개 연결

**System Message** (한국어):

```
# 역할
당신은 Google Calendar 일정 관리 전문 AI 어시스턴트입니다.

# 현재 날짜 및 시간 정보
- 오늘 날짜: {{ $today.format('yyyy-MM-dd') }}
- 현재 요일: {{ $today.format('dddd') }}
- 현재 시간: {{ $now.format('HH:mm') }}

# 주요 임무
사용자의 캘린더 일정을 생성, 조회, 수정, 삭제하는 작업을 수행합니다.

# 작업 지침

## 1. 일정 생성 시
- 제목(summary)은 필수입니다
- 날짜/시간이 명확하지 않으면 반드시 사용자에게 확인하세요
- 시간대는 'Asia/Seoul'을 기본값으로 사용하세요
- 종일 일정인지 시간 지정 일정인지 구분하세요
- 상대적 시간 표현(내일, 다음 주 월요일 등)을 정확한 날짜로 변환하세요

## 2. 일정 조회 시
- 기간을 명확히 설정하세요 (예: 오늘, 이번 주, 다음 달)
- 결과는 시간 순서대로 정리하여 보기 쉽게 제시하세요
- 일정이 없으면 "해당 기간에 일정이 없습니다"라고 알려주세요

## 3. 일정 수정 시
- 어떤 일정을 수정할지 명확히 확인하세요
- 변경할 내용만 업데이트하고 나머지는 유지하세요

## 4. 일정 삭제 시
- 삭제 전 일정 내용을 확인시켜주고 확인을 받으세요
- 실수로 삭제하지 않도록 주의하세요

# 날짜/시간 처리 규칙
- "내일" → 오늘 + 1일
- "모레" → 오늘 + 2일
- "다음 주" → 오늘 + 7일
- "이번 주 금요일" → 이번 주의 금요일 날짜 계산
- 시간이 없으면 기본값 사용: 오전 9시 또는 사용자에게 확인

# 응답 형식
- 간결하고 명확하게 답변하세요
- 작업 완료 시 확인 메시지를 제공하세요
- 오류 발생 시 이유를 설명하고 해결 방법을 제안하세요

# 예시 대화
사용자: "내일 오후 3시에 팀 회의 일정 잡아줘"
어시스턴트: "내일({{ $today.plus({days: 1}).format('yyyy-MM-dd') }}) 오후 3시에 '팀 회의' 일정을 생성하겠습니다. 회의 시간은 얼마나 예상되나요?"

# 중요 사항
- 모호한 요청은 반드시 명확히 확인하세요
- 개인정보 보호를 위해 민감한 정보는 주의깊게 다루세요
- 작업 전 중요한 변경사항은 사용자 확인을 받으세요
```

### 3. OpenAI Chat Model 설정

**OpenAI Chat Model 노드 추가**

- **Model**: gpt-5
- **Credentials**: OpenAI API 키 설정
- **Connection**: Agent 노드의 Language Model 입력에 연결

### 4. Simple Memory 설정

**Memory Buffer Window 노드 추가**

- **Type**: Buffer Window Memory
- **Context Window Length**: 10 (최근 10턴의 대화 기억)
- **Connection**: Agent 노드의 Memory 입력에 연결

### 5. Google Calendar 도구 설정

#### (1) Create an event in Google Calendar

**Google Calendar Tool 노드 추가**

- **Operation**: Create
- **Calendar**: 캘린더 선택 (예: coree2k.biz@gmail.com)
- **Start**: `{{ $fromAI('Start', '', 'string') }}`
- **End**: `{{ $fromAI('End', '', 'string') }}`
- **Use Default Reminders**: true
- **Additional Fields**:
  - Summary: `{{ $fromAI('Summary', '', 'string') }}`
  - Description: `{{ $fromAI('Description', '', 'string') }}`
- **Credentials**: Google Calendar OAuth2 인증 정보

#### (2) Delete an event in Google Calendar

**Google Calendar Tool 노드 추가**

- **Operation**: Delete
- **Calendar**: 캘린더 선택
- **Event ID**: `{{ $fromAI('Event_ID', '', 'string') }}`
- **Credentials**: Google Calendar OAuth2 인증 정보

#### (3) Update an event in Google Calendar

**Google Calendar Tool 노드 추가**

- **Operation**: Update
- **Calendar**: 캘린더 선택
- **Event ID**: `{{ $fromAI('Event_ID', '', 'string') }}`
- **Use Default Reminders**: `{{ $fromAI('Use_Default_Reminders', '', 'boolean') }}`
- **Update Fields**:
  - Summary: `{{ $fromAI('Summary', '', 'string') }}`
  - Description: `{{ $fromAI('Description', '', 'string') }}`
- **Credentials**: Google Calendar OAuth2 인증 정보

#### (4) Get an event in Google Calendar

**Google Calendar Tool 노드 추가**

- **Operation**: Get
- **Calendar**: 캘린더 선택
- **Event ID**: `{{ $fromAI('Event_ID', '', 'string') }}`
- **Options**:
  - Time Zone: Asia/Seoul
- **Credentials**: Google Calendar OAuth2 인증 정보

#### (5) Get many events in Google Calendar

**Google Calendar Tool 노드 추가**

- **Operation**: Get All
- **Calendar**: 캘린더 선택
- **Options**:
  - Time Zone: Asia/Seoul
- **Credentials**: Google Calendar OAuth2 인증 정보

### 6. 노드 연결

**연결 구조**:

1. **When chat message received** → **Google Calendar Agent**
2. **OpenAI Chat Model** → **Google Calendar Agent** (ai_languageModel)
3. **Simple Memory** → **Google Calendar Agent** (ai_memory)
4. **Create an event in Google Calendar1** → **Google Calendar Agent** (ai_tool)
5. **Delete an event in Google Calendar** → **Google Calendar Agent** (ai_tool)
6. **Update an event in Google Calendar** → **Google Calendar Agent** (ai_tool)
7. **Get an event in Google Calendar** → **Google Calendar Agent** (ai_tool)
8. **Get many events in Google Calendar** → **Google Calendar Agent** (ai_tool)

## 고급 활용 팁

### 1. 반복 일정 설정

반복 일정을 만들려면 Google Calendar Tool의 Additional Fields에 `recurrence` 필드를 추가할 수 있습니다:

```
RRULE:FREQ=WEEKLY;BYDAY=MO,WE,FR
```

### 2. 참석자 추가

회의에 다른 사람을 초대하려면 `attendees` 필드를 추가합니다:

```json
{
  "email": "user@example.com",
  "responseStatus": "needsAction"
}
```

### 3. 알림 커스터마이징

기본 알림 대신 커스텀 알림을 설정할 수 있습니다:

```json
{
  "method": "email",
  "minutes": 1440
}
```

### 4. 대화 메모리 조정

더 긴 대화를 기억하려면 Simple Memory의 Context Window Length를 늘릴 수 있습니다:
- 짧은 대화: 5-10
- 일반적인 사용: 10-20
- 긴 대화: 20-50

### 5. 시스템 메시지 커스터마이징

시스템 메시지를 수정하여 에이전트의 성격이나 작업 방식을 변경할 수 있습니다:
- 더 친근한 톤
- 특정 업무에 특화된 기능
- 회사 내부 규칙 반영

## 문제 해결

### 자주 발생하는 문제들

#### 1. OAuth 인증 오류

**증상**: "Authentication failed" 오류

**해결 방법**:
- Google Cloud Console에서 OAuth 동의 화면이 올바르게 설정되었는지 확인
- 리디렉션 URI가 정확한지 확인
- API가 활성화되었는지 확인
- 토큰을 재발급 받아보세요

#### 2. 일정 생성 실패

**증상**: 일정이 생성되지 않음

**해결 방법**:
- Start와 End 시간 형식이 올바른지 확인 (ISO 8601 형식)
- 시간대 설정 확인
- 캘린더 권한 확인
- Summary(제목)가 비어있지 않은지 확인

#### 3. AI가 날짜를 잘못 이해함

**증상**: "내일" 같은 상대적 표현을 잘못 해석

**해결 방법**:
- 시스템 메시지의 현재 날짜 변수가 올바르게 설정되었는지 확인
- 날짜 처리 규칙을 더 명확하게 작성
- 사용자에게 정확한 날짜 확인을 요청하도록 설정

#### 4. 메모리가 작동하지 않음

**증상**: 이전 대화를 기억하지 못함

**해결 방법**:
- Simple Memory 노드가 Agent에 올바르게 연결되었는지 확인
- Context Window Length 값 확인
- 워크플로우를 재시작해보세요

#### 5. 한국어 응답 품질 문제

**증상**: 어색한 한국어 또는 영어 혼용

**해결 방법**:
- 시스템 메시지에 "한국어로만 응답" 명시
- GPT-5 모델이 선택되었는지 확인
- 프롬프트에 더 많은 한국어 예시 추가

### 디버깅 팁

1. **n8n 실행 로그 확인**:
   - 각 노드의 실행 결과를 클릭하여 확인
   - 오류 메시지 자세히 읽기

2. **단계별 테스트**:
   - 먼저 간단한 일정 생성부터 테스트
   - 각 도구를 개별적으로 테스트

3. **API 응답 확인**:
   - Google Calendar API의 실제 응답 확인
   - 에러 코드와 메시지 분석

## 실제 사용 예시

### 일정 생성

**사용자**: "내일 오후 2시에 클라이언트 미팅 잡아줘. 1시간 정도 걸릴 것 같아."

**AI 에이전트**:
```
네, 내일(2025-10-11) 오후 2시부터 3시까지 '클라이언트 미팅' 일정을 생성하겠습니다.
일정이 성공적으로 추가되었습니다. ✓
```

### 일정 조회

**사용자**: "이번 주 일정 알려줘"

**AI 에이전트**:
```
이번 주(10/10-10/16) 일정입니다:

**10월 11일 (토)**
- 14:00-15:00: 클라이언트 미팅

**10월 12일 (일)**
- 일정 없음

**10월 13일 (월)**
- 09:00-10:00: 주간 팀 회의
- 15:00-16:00: 프로젝트 리뷰

총 3개의 일정이 있습니다.
```

### 일정 수정

**사용자**: "내일 클라이언트 미팅 시간을 3시로 변경해줘"

**AI 에이전트**:
```
내일(10/11)의 '클라이언트 미팅' 일정을 확인했습니다.
시작 시간을 14:00에서 15:00로 변경하시겠습니까?
```

**사용자**: "응"

**AI 에이전트**:
```
일정이 수정되었습니다. ✓
- 클라이언트 미팅
- 변경 후: 10월 11일 15:00-16:00
```

### 일정 삭제

**사용자**: "내일 클라이언트 미팅 취소해줘"

**AI 에이전트**:
```
다음 일정을 삭제하시겠습니까?

- 제목: 클라이언트 미팅
- 날짜: 10월 11일 15:00-16:00

삭제하시려면 "삭제" 또는 "확인"이라고 말씀해주세요.
```

**사용자**: "확인"

**AI 에이전트**:
```
'클라이언트 미팅' 일정이 삭제되었습니다. ✓
```

## 확장 아이디어

이 기본 워크플로우를 바탕으로 다음과 같은 기능을 추가할 수 있습니다:

### 1. Slack 통합
- 일정 생성 시 Slack으로 알림
- Slack에서 일정 확인 가능

### 2. 이메일 연동
- 회의 일정 생성 시 자동 이메일 발송
- 참석자에게 회의 안내 전송

### 3. 음성 인터페이스
- n8n의 음성 입력 기능 활용
- 더 자연스러운 대화 경험

### 4. 다중 캘린더 지원
- 여러 캘린더 동시 관리
- 업무/개인 캘린더 구분

### 5. 스마트 일정 제안
- 빈 시간대 자동 탐색
- 최적의 회의 시간 추천

## 보안 고려사항

### 1. API 키 관리
- OpenAI API 키를 안전하게 보관
- n8n의 Credentials 기능 활용
- 절대 코드에 하드코딩하지 않기

### 2. OAuth 토큰
- Google OAuth 토큰의 유효기간 확인
- 자동 토큰 갱신 설정
- 토큰을 암호화하여 저장

### 3. 접근 권한
- 필요한 최소한의 권한만 요청
- 공개 워크플로우 사용 시 주의
- 민감한 정보는 환경 변수로 관리

### 4. 데이터 보호
- 대화 내용의 로그 관리
- 개인정보 처리 방침 준수
- 불필요한 데이터는 주기적으로 삭제

## 성능 최적화

### 1. 응답 속도 개선
- GPT-5 대신 더 빠른 모델 사용 (필요시)
- 불필요한 도구 호출 최소화
- 프롬프트 최적화로 토큰 사용량 감소

### 2. 비용 절감
- 적절한 메모리 윈도우 설정
- 효율적인 프롬프트 작성
- API 호출 횟수 모니터링

### 3. 안정성 향상
- 에러 핸들링 강화
- 재시도 로직 추가
- 타임아웃 설정

## 결론

> Google Calendar AI 에이전트는 자연어로 캘린더를 관리할 수 있게 해주는 강력한 도구입니다. 복잡한 명령어를 외울 필요 없이 일상적인 대화처럼 일정을 관리할 수 있어, 업무 효율성을 크게 높일 수 있습니다.
>
> 이 가이드에서 제공하는 기본 구조를 바탕으로 자신의 필요에 맞게 커스터마이징하고 확장해보세요. AI 에이전트의 성격을 바꾸거나, 다른 도구들과 연동하거나, 회사의 업무 프로세스에 맞게 조정할 수 있습니다.
>
> n8n의 노코드/로우코드 접근 방식 덕분에 프로그래밍 지식이 많지 않아도 충분히 구축할 수 있으며, 한 번 설정해두면 지속적으로 활용할 수 있는 유용한 도구가 될 것입니다.

## 참고 자료

- [n8n 공식 문서](https://docs.n8n.io/)
- [Google Calendar API 문서](https://developers.google.com/calendar/api)
- [OpenAI API 문서](https://platform.openai.com/docs)
- [n8n AI Agent 가이드](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/)
- [Google Cloud Console](https://console.cloud.google.com/)
